<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, viewport-fit=cover"> <title>Alvorada - Gest√£o T√°tica</title>
    
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script> <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script> <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script> <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script> <style>
        /* --- DESIGN HARMONIOSO E CORES PAST√âIS (ESTILO SMARTPHONE) --- */
        :root {
            --bg-dark: #1a1c24; /* Fundo Dark Profundo conforme imagem */
            --card-surface: #2d3039; /* Superf√≠cie do Board */
            --pastel-gold: #d4a373; /* T√≠tulo Alvorada */
            --pastel-blue: #a8dadc; /* Progresso 0-30% */
            --pastel-pink: #f28482; /* Progresso 31-70% / Bot√£o + */
            --pastel-green: #b9fbc0; /* Progresso 71-100% / Check */
            --text-white: #ffffff;
            --text-gray: #94a3b8;
        }

        body {
            font-family: 'Quicksand', sans-serif; background-color: var(--bg-dark); color: var(--text-white);
            margin: 0; padding: env(safe-area-inset-top) 20px 100px 20px;
            display: flex; flex-direction: column; align-items: center; min-height: 100vh;
            overflow-x: hidden; transition: filter 0.4s ease;
        }

        /* Dimensionamento Excelente do Board */
        .board {
            width: 100%; max-width: 480px; background: var(--card-surface);
            padding: 35px 30px; border-radius: 40px; box-shadow: 0 30px 60px rgba(0,0,0,0.6);
            margin-top: 20px; box-sizing: border-box; position: relative;
        }

        /* Cabe√ßalho: T√≠tulo e Contagem */
        header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 25px; }
        .brand h1 { font-size: 1.9rem; color: var(--pastel-gold); margin: 0; font-weight: 700; }
        #live-date { font-size: 0.95rem; color: var(--text-gray); text-transform: capitalize; margin-top: 4px; }
        .counter { font-weight: 800; color: #ff9f43; font-size: 1.2rem; display: flex; align-items: center; gap: 5px; }

        /* Barra de Progresso Colorida Conforme Avan√ßa */
        .progress-track { background: rgba(255,255,255,0.05); height: 12px; border-radius: 10px; overflow: hidden; margin: 25px 0 8px; }
        #progress-fill { height: 100%; width: 0%; transition: 1.2s cubic-bezier(0.1, 0.7, 0.1, 1); }
        #percentage-text { text-align: right; font-weight: 800; color: var(--pastel-green); font-size: 0.85rem; margin-bottom: 30px; }

        /* Input de Tarefas */
        .input-area { display: flex; gap: 12px; margin-bottom: 35px; }
        #task-input { flex: 1; background: rgba(0,0,0,0.2); border: 1px solid rgba(255,255,255,0.08); border-radius: 20px; padding: 18px; color: white; outline: none; font-size: 16px; }
        .btn-confirm { background: var(--pastel-pink); border: none; width: 55px; height: 55px; border-radius: 18px; color: white; font-size: 2rem; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: 0.3s; }

        /* Lista de Miss√µes Ativas */
        #mission-list { padding: 0; list-style: none; margin: 0; }
        .mission-item { 
            background: rgba(255,255,255,0.02); padding: 20px; border-radius: 22px; 
            display: flex; align-items: center; margin-bottom: 15px; border: 1px solid rgba(255,255,255,0.04);
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .mission-item input[type="checkbox"] { width: 24px; height: 24px; cursor: pointer; accent-color: var(--pastel-green); }
        .mission-item span { margin-left: 15px; flex: 1; font-size: 1.1rem; }
        .btn-delete { background: none; border: none; cursor: pointer; font-size: 1.3rem; color: #f28482; opacity: 0.3; transition: 0.3s; }
        .btn-delete:hover { opacity: 1; }

        /* Frase Motivacional (20+ frases) */
        #quote-display { text-align: center; font-size: 0.95rem; font-style: italic; color: var(--text-gray); margin: 35px 0; min-height: 40px; padding: 0 10px; line-height: 1.5; }

        /* Bot√µes de Dias (Resumo embaixo do Board) */
        .history-grid { display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; margin-top: 25px; max-width: 480px; }
        .day-btn { width: 42px; height: 42px; border: 2px solid #444; border-radius: 50%; color: #666; font-size: 0.9rem; background: none; cursor: pointer; transition: 0.4s; }
        .day-btn.completed { border-color: var(--pastel-green); color: var(--pastel-green); box-shadow: 0 0 10px rgba(185, 251, 192, 0.3); }

        /* Bot√£o Gerar Relat√≥rio PDF */
        .btn-pdf { background: none; border: 2px solid var(--pastel-gold); color: var(--pastel-gold); padding: 15px 35px; border-radius: 25px; font-weight: 800; cursor: pointer; display: block; margin: 30px auto 0; font-size: 0.85rem; letter-spacing: 1px; }

        /* Bot√£o DarkLight Flutuante (N√£o some no Zoom) */
        .fab-dock { position: fixed; bottom: 30px; right: 25px; display: flex; flex-direction: column; gap: 15px; z-index: 10000; pointer-events: none; }
        .fab-dock button { pointer-events: auto; width: 60px; height: 60px; border-radius: 50%; border: none; background: var(--card-surface); color: white; box-shadow: 0 10px 30px rgba(0,0,0,0.5); cursor: pointer; font-size: 1.5rem; border: 1px solid rgba(255,255,255,0.1); }

        /* Tela de Acesso (Seguran√ßa Firebase) */
        #auth-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg-dark); z-index: 99999; display: flex; align-items: center; justify-content: center; }
        .auth-container { width: 90%; max-width: 380px; text-align: center; }
        .auth-input { width: 100%; padding: 20px; margin-bottom: 15px; border-radius: 18px; border: 1px solid #444; background: #222; color: white; box-sizing: border-box; font-size: 16px; }
        .auth-main-btn { width: 100%; padding: 20px; background: var(--pastel-gold); border: none; border-radius: 18px; color: white; font-weight: bold; cursor: pointer; font-size: 1.1rem; }
        .hidden { display: none !important; }
    </style>
</head>
<body ondblclick="toggleFullScreen()"> <div id="auth-screen">
    <div class="board auth-container">
        <h1 id="auth-title">Recrutamento Alvorada</h1>
        <div style="margin-top: 35px;">
            <input type="text" id="user-field" class="auth-input" placeholder="Seu Nome de Agente"> <input type="password" id="pass-field" class="auth-input" placeholder="Sua Senha">
            <button onclick="handleAuthAction()" id="action-btn" class="auth-main-btn">CRIAR MINHA CONTA</button>
            <p onclick="toggleAuthMode()" style="font-size: 0.85rem; margin-top: 20px; cursor: pointer; color: var(--text-gray); text-decoration: underline;">J√° √© um Agente? Fa√ßa Login</p>
        </div>
    </div>
</div>

<div class="board" id="main-board">
    <header>
        <div class="brand">
            <h1>Alvorada</h1> <div id="live-date"></div> </div>
        <div class="counter">üî• <span id="streak-num">0</span> dias</div> </header>

    <div class="progress-track"><div id="progress-fill"></div></div>
    <div id="percentage-text">TOTAL: 0%</div> <div class="input-area">
        <input type="text" id="task-input" placeholder="O que vamos conquistar hoje?">
        <button class="btn-confirm" onclick="addTask()">+</button> </div>

    <ul id="mission-list"></ul> <div id="quote-display">"Iniciando Protocolo..."</div> <div class="history-grid" id="history-dots"></div>

    <button class="btn-pdf" onclick="generateTicket()">üìÑ SALVAR EM PDF</button>
</div>

<div class="fab-dock">
    <button onclick="toggleTheme()" title="Modo Noturno">üåô</button> <button onclick="firebase.auth().signOut()" title="Encerrar Sess√£o">üö™</button>
</div>

<script>
    /* --- L√ìGICA DE OPERA√á√ïES --- */
    
    // Configura√ß√µes do seu Firebase Studio (Corrigido)
    const firebaseConfig = {
      apiKey: "AIzaSyAavmFHrcPo8OY60hnLo2dK4BsylPKvPAQ",
      authDomain: "alvorada-23e01.firebaseapp.com",
      projectId: "alvorada-23e01",
      storageBucket: "alvorada-23e01.firebasestorage.app",
      messagingSenderId: "173441904175",
      appId: "1:173441904175:web:7d3a7aba8b90afa05ea0da"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // PACTO: M√≠nimo 20 frases motivacionais
    const missionQuotes = [
        "A const√¢ncia √© a m√£e da aprova√ß√£o.", "1% melhor a cada novo dia.", "N√£o pare at√© se orgulhar de quem voc√™ se tornou.",
        "A disciplina √© a ponte entre metas e realiza√ß√µes.", "Vencer a si mesmo √© a maior das vit√≥rias.",
        "Mantenha o foco na miss√£o, o cargo vir√°.", "Seu esfor√ßo de hoje √© o seu distintivo de amanh√£.",
        "Estude enquanto eles dormem.", "A vaga √© sua por m√©rito e suor.", "F√© na miss√£o, Agente!",
        "A dor do estudo √© tempor√°ria, o cargo √© vital√≠cio.", "Nada vence a persist√™ncia inabal√°vel.",
        "Sua √∫nica competi√ß√£o √© com quem voc√™ foi ontem.", "A aprova√ß√£o exige sacrif√≠cio e estrat√©gia.",
        "Seja mais forte que sua melhor desculpa.", "Transforme suor em sucesso t√°tico.",
        "Miss√£o dada √© miss√£o cumprida. Sem recuar.", "Paci√™ncia e resili√™ncia no caminho.",
        "O sucesso √© o ac√∫mulo de pequenos acertos di√°rios.", "Agente: sua rotina √© seu maior treinamento."
    ];

    let isLogin = false;
    let agentData = { tasks: [], percent: 0 };
    const now = new Date();
    // PACTO: Quinta-Feira, 29 De Janeiro
    const dateStr = now.toLocaleDateString('pt-BR', { weekday: 'long', day: 'numeric', month: 'long' });
    const cloudKey = now.toLocaleDateString('pt-BR'); // Chave DD/MM/AAAA para o Firebase

    // Seguran√ßa e Autentica√ß√£o (Resolvendo "Badly Formatted Email")
    function toggleAuthMode() {
        isLogin = !isLogin;
        document.getElementById('auth-title').innerText = isLogin ? "Acesso Alvorada" : "Recrutamento Alvorada";
        document.getElementById('action-btn').innerText = isLogin ? "ENTRAR NO SISTEMA" : "CRIAR MINHA CONTA";
    }

    function handleAuthAction() {
        const rawName = document.getElementById('user-field').value.trim();
        const pass = document.getElementById('pass-field').value;
        if(!rawName || pass.length < 6) { alert("Nome obrigat√≥rio e senha m√≠n. 6 caracteres."); return; }
        
        // Transforma√ß√£o Interna: "carina" vira "carina@alvorada.com" para satisfazer o Firebase
        const agentEmail = `${rawName.toLowerCase().replace(/\s/g, '')}@alvorada.com`;
        
        const action = isLogin 
            ? firebase.auth().signInWithEmailAndPassword(agentEmail, pass)
            : firebase.auth().createUserWithEmailAndPassword(agentEmail, pass);

        action.catch(err => alert("Erro Operacional: " + err.message));
    }

    firebase.auth().onAuthStateChanged(user => {
        if(user) {
            document.getElementById('auth-screen').classList.add('hidden');
            syncBase();
            document.getElementById('quote-display').innerText = `"${missionQuotes[Math.floor(Math.random()*missionQuotes.length)]}"`;
        } else {
            document.getElementById('auth-screen').classList.remove('hidden');
        }
    });

    // Sincroniza√ß√£o e Persist√™ncia (PACTO: Manter tarefas de X para Y)
    async function syncBase() {
        const uid = firebase.auth().currentUser.uid;
        const doc = await db.collection("usuarios").doc(uid).collection("dias").doc(cloudKey).get();
        
        if(doc.exists) {
            agentData = doc.data();
        } else {
            // Se for um novo dia, busca as tarefas do dia anterior mas com status "pendente"
            const lastLog = await db.collection("usuarios").doc(uid).collection("dias").orderBy("__name__", "desc").limit(1).get();
            if(!lastLog.empty) {
                agentData.tasks = lastLog.docs[0].data().tasks.map(t => ({...t, done: false, id: Date.now()+Math.random()}));
            }
        }
        renderMissions();
        updateStreak(uid);
    }

    function renderMissions() {
        const list = document.getElementById('mission-list');
        list.innerHTML = '';
        let done = 0;

        agentData.tasks.forEach(t => {
            const li = document.createElement('li');
            li.className = 'mission-item';
            li.innerHTML = `
                <input type="checkbox" ${t.done ? 'checked' : ''} onchange="toggleTask('${t.id}')">
                <span style="${t.done ? 'text-decoration:line-through; opacity:0.3' : ''}">${t.text}</span>
                <button class="btn-delete" onclick="removeTask('${t.id}')">üóëÔ∏è</button>
            `;
            list.appendChild(li);
            if(t.done) done++;
        });

        const perc = agentData.tasks.length > 0 ? Math.round((done / agentData.tasks.length) * 100) : 0;
        
        // Cor da barra pastel din√¢mica
        const bar = document.getElementById('progress-fill');
        if(perc <= 30) bar.style.background = 'var(--pastel-blue)';
        else if(perc <= 70) bar.style.background = 'var(--pastel-pink)';
        else bar.style.background = 'var(--pastel-green)';
        
        bar.style.width = perc + '%';
        document.getElementById('percentage-text').innerText = `TOTAL: ${perc}%`;
        
        if(perc === 100 && agentData.percent < 100) confetti({ particleCount: 150, spread: 70, origin: { y: 0.8 } });
        
        agentData.percent = perc;
        saveToCloud();
    }

    function addTask() {
        const input = document.getElementById('task-input');
        if(!input.value) return;
        // PACTO: Definindo ID √önico por Timestamp
        agentData.tasks.push({ id: Date.now().toString() + Math.random(), text: input.value, done: false });
        input.value = '';
        renderMissions();
    }

    function toggleTask(id) {
        const task = agentData.tasks.find(x => x.id === id);
        if(task) task.done = !task.done;
        renderMissions();
    }

    function removeTask(id) {
        agentData.tasks = agentData.tasks.filter(x => x.id !== id);
        renderMissions();
    }

    function saveToCloud() {
        const user = firebase.auth().currentUser;
        if(user) db.collection("usuarios").doc(user.uid).collection("dias").doc(cloudKey).set(agentData);
    }

    // PACTO: Gerar Ticket de Mercado PDF
    function generateTicket() {
        const ticket = document.createElement('div');
        ticket.style.cssText = "width: 80mm; padding: 20px; font-family: 'Courier New', monospace; color: black; background: white;";
        
        let rows = agentData.tasks.map(t => `
            <div style="display: flex; justify-content: space-between; border-bottom: 1px dashed #ccc; padding: 5px 0; font-size: 12px;">
                <span style="max-width: 170px;">${t.text.toUpperCase()}</span>
                <span style="font-weight: bold;">${t.done ? 'OK' : '--'}</span>
            </div>
        `).join('');

        ticket.innerHTML = `
            <div style="text-align:center; border-bottom: 2px solid #000; padding-bottom: 10px; margin-bottom: 10px;">
                <h2 style="margin:0;">RELAT√ìRIO</h2>
                <small>ALVORADA T√ÅTICO</small><br>
                <small>${dateStr.toUpperCase()}</small>
            </div>
            <div style="margin-bottom: 10px;">
                <div style="display:flex; justify-content:space-between; font-weight:bold; border-bottom:1px solid #000; margin-bottom:5px;">
                    <span>TAREFA</span>
                    <span>STATUS</span>
                </div>
                ${rows}
            </div>
            <div style="text-align:right; font-weight:bold; border-top: 2px solid #000; padding-top:10px; font-size: 1.1rem;">
                APROVEITAMENTO: ${agentData.percent}%
            </div>
            <div style="text-align:center; margin-top:25px; font-size:10px; border-top: 1px dashed #000; padding-top: 10px;">
                *** COMPROVANTE DE MISS√ÉO ***
            </div>
        `;

        const opt = { margin: 10, filename: `Relatorio_Agente_${cloudKey}.pdf`, jsPDF: { unit: 'mm', format: [80, 150] } };
        html2pdf().set(opt).from(ticket).save();
    }

    // Hist√≥rico de C√≠rculos (1 a 8)
    async function updateStreak(uid) {
        const snap = await db.collection("usuarios").doc(uid).collection("dias").orderBy("__name__", "desc").limit(8).get();
        const grid = document.getElementById('history-dots');
        grid.innerHTML = '';
        
        document.getElementById('streak-num').innerText = snap.size;

        for(let i=1; i<=8; i++) {
            const dot = document.createElement('button');
            dot.className = 'day-btn';
            dot.innerText = i;
            // Se o dia existir e estiver 100%, pinta de verde
            const dayData = snap.docs[snap.size - i];
            if(dayData && dayData.data().percent === 100) dot.classList.add('completed');
            grid.appendChild(dot);
        }
    }

    function toggleTheme() {
        const isDark = document.body.style.filter === 'invert(1)';
        document.body.style.filter = isDark ? 'invert(0)' : 'invert(1)';
        document.body.style.backgroundColor = isDark ? '#1a1c24' : '#eee';
    }

    function toggleFullScreen() {
        if (!document.fullscreenElement) document.documentElement.requestFullscreen();
        else document.exitFullscreen();
    }

    document.getElementById('live-date').innerText = dateStr;
</script>
</body>
</html>
