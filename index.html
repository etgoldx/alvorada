<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, viewport-fit=cover"> <title>Alvorada</title>
    
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>

    <style>
        :root { /* Paleta de cores extra√≠da da imagem enviada */
            --bg-deep: #1a1c24; /* Fundo escuro da p√°gina */
            --card-dark: #2d3039; /* Fundo do painel centralizado */
            --accent-brown: #a68966; /* Cor dos bot√µes e t√≠tulos */
            --text-gray: #999; /* Cor da data e frases */
            --white: #ffffff; /* Texto principal */
            --plus-bg: #f28482; /* Cor rosada do bot√£o + */
        }

        body { /* Estilo do corpo com fundo escuro conforme imagem */
            font-family: 'Quicksand', sans-serif; background-color: var(--bg-deep);
            margin: 0; padding: 40px 20px; display: flex; flex-direction: column; align-items: center;
            color: var(--white); min-height: 100vh; transition: 0.4s;
        }

        .container { /* Painel central arredondado da imagem */
            width: 100%; max-width: 400px; background: var(--card-dark); 
            padding: 30px; border-radius: 40px; box-shadow: 0 15px 35px rgba(0,0,0,0.3);
        }

        header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px; }
        h1 { font-size: 1.5rem; margin: 0; font-weight: 500; }
        #date-display { font-size: 0.85rem; color: var(--text-gray); margin-top: 5px; }

        /* Barra de progresso fina e elegante da imagem */
        .progress-track { background: rgba(255,255,255,0.1); height: 6px; border-radius: 10px; margin: 20px 0 5px; }
        #progress-bar { height: 100%; width: 0%; background: #555; border-radius: 10px; transition: 0.8s; }
        #stats-label { text-align: right; font-size: 0.75rem; color: #7ebc89; font-weight: bold; margin-bottom: 25px; }

        /* Input de conquista conforme a imagem */
        .input-area { display: flex; gap: 10px; background: rgba(0,0,0,0.2); padding: 8px; border-radius: 15px; margin-bottom: 30px; }
        input { background: none; border: none; color: white; flex: 1; padding: 10px; outline: none; }
        .add-btn { background: var(--plus-bg); border: none; color: white; width: 45px; height: 45px; border-radius: 12px; font-size: 1.5rem; cursor: pointer; }

        /* Frase centralizada em it√°lico */
        #quote-text { text-align: center; font-size: 0.85rem; font-style: italic; color: var(--text-gray); margin-top: 20px; }

        /* C√≠rculos de Status (1 a 8) da imagem */
        .status-circles { display: flex; justify-content: center; gap: 8px; margin: 30px 0; }
        .circle { width: 35px; height: 35px; border: 1px solid #555; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.75rem; color: #777; transition: 0.3s; }
        .circle.done { border-color: #7ebc89; color: #7ebc89; }

        /* Bot√£o Salvar PDF centralizado e arredondado */
        .pdf-btn { background: #555; border: none; color: white; padding: 12px 25px; border-radius: 15px; font-size: 0.8rem; font-weight: bold; cursor: pointer; display: flex; align-items: center; gap: 8px; margin: 0 auto; }

        /* Lista de tarefas (invis√≠vel na imagem mas necess√°ria para o sistema) */
        #todo-list { list-style: none; padding: 0; margin-bottom: 20px; }
        .todo-item { display: flex; align-items: center; margin-bottom: 10px; font-size: 0.9rem; border-bottom: 1px solid rgba(255,255,255,0.05); padding-bottom: 8px; }
        .todo-item input { margin-right: 10px; flex: none; }

        /* Bot√µes flutuantes para DarkMode e Sair */
        .floating-controls { position: fixed; bottom: 30px; right: 25px; display: flex; gap: 10px; }
        .control-btn { width: 45px; height: 45px; border-radius: 50%; border: none; background: #3d414d; color: white; cursor: pointer; }

        /* Tela de Login integrada */
        #auth-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg-deep); z-index: 9999; display: flex; align-items: center; justify-content: center; }
        .auth-hidden { display: none !important; }
    </style>
</head>
<body ondblclick="toggleFullScreen()"> <div id="auth-screen">
    <div class="container" style="text-align: center;">
        <h1 id="auth-title">Portaria Alvorada</h1>
        <input type="text" id="auth-user" placeholder="Nome do Agente" style="width: 80%; border-bottom: 1px solid #555; margin: 20px 0;">
        <input type="password" id="auth-pass" placeholder="Senha" style="width: 80%; border-bottom: 1px solid #555; margin-bottom: 20px;">
        <button onclick="handleAuth()" id="auth-btn" style="width:100%; padding:15px; background:var(--accent-brown); border-radius:15px; border:none; color:white; font-weight:bold;">ACESSAR</button>
        <p onclick="toggleAuth()" id="auth-toggle" style="font-size:0.7rem; margin-top:15px; cursor:pointer;">N√£o tem conta? Cadastre-se</p>
    </div>
</div>

<div class="container" id="app-content">
    <header>
        <div>
            <h1>Alvorada</h1>
            <div id="date-display"></div>
        </div>
        <div style="color: #ff9f43; font-weight: bold; font-size: 0.9rem;">üî• <span id="streak-count">0</span> dias</div>
    </header>

    <div class="progress-track"><div id="progress-bar"></div></div>
    <div id="stats-label">TOTAL: 0%</div> <div class="input-area">
        <input type="text" id="todo-input" placeholder="O que vamos conquistar hoje?">
        <button class="add-btn" onclick="addTodo()">+</button>
    </div>

    <ul id="todo-list"></ul> <div id="quote-text"></div> <div class="status-circles" id="circles-box"></div>

    <button class="pdf-btn" onclick="exportPDF()">üìÑ SALVAR EM PDF</button>
</div>

<div class="floating-controls">
    <button class="control-btn" onclick="toggleTheme()">‚òÄÔ∏è</button>
    <button class="control-btn" onclick="firebase.auth().signOut()">üö™</button>
</div>

<script>
    // 1. Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyAavmFHrcPo8OY60hnLo2dK4BsylPKvPAQ",
      authDomain: "alvorada-23e01.firebaseapp.com",
      projectId: "alvorada-23e01",
      storageBucket: "alvorada-23e01.firebasestorage.app",
      messagingSenderId: "173441904175",
      appId: "1:173441904175:web:7d3a7aba8b90afa05ea0da"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // 2. Banco de 20 Frases Motivacionais
    const quotes = [
        "O imposs√≠vel √© um punhado de coisas f√°ceis.", "N√£o pare at√© se orgulhar.", "1% melhor a cada dia.",
        "A const√¢ncia vence o talento.", "Vencer a si mesmo √© a maior vit√≥ria.", "Sua rotina √© seu treinamento.",
        "A disciplina √© liberdade.", "Foque no processo, o resultado vem.", "N√£o espere motiva√ß√£o, cultive h√°bito.",
        "Cada passo te aproxima da PC.", "A dor √© passageira, o cargo √© eterno.", "Miss√£o dada √© miss√£o cumprida.",
        "Seja mais forte que sua desculpa.", "Estude enquanto eles dormem.", "A aprova√ß√£o exige sacrif√≠cio.",
        "Mantenha o foco, a vaga √© sua.", "O sucesso exige repeti√ß√£o.", "Paci√™ncia e persist√™ncia.",
        "Transforme suor em gl√≥ria.", "Alvorada: recomece todo dia."
    ];

    let isLogin = true;
    let dbLocal = { todos: [], percent: 0 };
    const dateObj = new Date();
    // Quinta-feira, 29 de Janeiro
    const dateFull = dateObj.toLocaleDateString('pt-BR', { weekday: 'long', day: 'numeric', month: 'long' });
    const dbID = dateObj.toLocaleDateString('pt-BR'); // ID da data para o banco

    // Autentica√ß√£o por Nome (Pacto Agente)
    function toggleAuth() {
        isLogin = !isLogin;
        document.getElementById('auth-title').innerText = isLogin ? "Portaria Alvorada" : "Recrutamento Alvorada";
        document.getElementById('auth-btn').innerText = isLogin ? "ACESSAR" : "CRIAR CONTA";
    }

    function handleAuth() {
        const user = document.getElementById('auth-user').value.trim();
        const pass = document.getElementById('auth-pass').value;
        if(!user || !pass) return;
        const email = `${user.toLowerCase().replace(/\s/g,'')}@alvorada.com`; // Sanitiza√ß√£o
        const action = isLogin ? firebase.auth().signInWithEmailAndPassword(email, pass) : firebase.auth().createUserWithEmailAndPassword(email, pass);
        action.catch(e => alert("Erro: " + e.message));
    }

    firebase.auth().onAuthStateChanged(user => {
        if(user) {
            document.getElementById('auth-screen').classList.add('auth-hidden');
            loadData();
            document.getElementById('quote-text').innerText = `"${quotes[Math.floor(Math.random()*quotes.length)]}"`;
        } else {
            document.getElementById('auth-screen').classList.remove('auth-hidden');
        }
    });

    // Banco de Dados e Interface
    async function loadData() {
        const user = firebase.auth().currentUser;
        const doc = await db.collection("usuarios").doc(user.uid).collection("dias").doc(dbID).get();
        if(doc.exists) dbLocal = doc.data();
        updateUI();
    }

    function updateUI() {
        const list = document.getElementById('todo-list');
        const circles = document.getElementById('circles-box');
        list.innerHTML = ''; circles.innerHTML = '';
        let done = 0;

        dbLocal.todos.forEach((t, i) => {
            // Renderiza lista para marca√ß√£o
            const li = document.createElement('li'); li.className = 'todo-item';
            li.innerHTML = `<input type="checkbox" ${t.completed ? 'checked' : ''} onchange="toggleTodo('${t.id}')"> <span>${t.text}</span>`;
            list.appendChild(li);
            if(t.completed) done++;

            // Renderiza os c√≠rculos 1 a 8 da imagem
            if(i < 8) {
                const c = document.createElement('div');
                c.className = `circle ${t.completed ? 'done' : ''}`;
                c.innerText = i + 1;
                circles.appendChild(c);
            }
        });

        const p = dbLocal.todos.length > 0 ? Math.round((done/dbLocal.todos.length)*100) : 0;
        document.getElementById('progress-bar').style.width = p + '%';
        document.getElementById('stats-label').innerText = `TOTAL: ${p}%`;
        dbLocal.percent = p;
        if(p === 100) confetti({ particleCount: 100 });
        saveData();
    }

    function saveData() {
        const user = firebase.auth().currentUser;
        if(user) db.collection("usuarios").doc(user.uid).collection("dias").doc(dbID).set(dbLocal);
    }

    function addTodo() {
        const val = document.getElementById('todo-input').value;
        if(!val) return;
        // PACTO: DEFININDO ID √öNICO
        dbLocal.todos.push({ id: Date.now().toString(), text: val, completed: false });
        document.getElementById('todo-input').value = '';
        updateUI();
    }

    function toggleTodo(id) {
        const t = dbLocal.todos.find(x => x.id === id);
        if(t) t.completed = !t.completed;
        updateUI();
    }

    // Exporta√ß√£o PDF Estilo Ticket (Relat√≥rio)
    function exportPDF() {
        const content = document.createElement('div');
        content.style.padding = "20px"; content.style.fontFamily = "monospace";
        content.innerHTML = `
            <center><h2>ALVORADA - RELAT√ìRIO</h2><p>${dateFull}</p></center>
            <hr>
            ${dbLocal.todos.map(t => `<div style="display:flex; justify-content:space-between;"><span>${t.text}</span><span>${t.completed ? 'OK' : '--'}</span></div>`).join('')}
            <hr>
            <div style="text-align:right"><b>TOTAL: ${dbLocal.percent}%</b></div>
        `;
        const opt = { margin: 10, filename: 'Relatorio_Alvorada.pdf', jsPDF: { unit: 'mm', format: [80, 150] } };
        html2pdf().set(opt).from(content).save();
    }

    function toggleTheme() { document.body.style.filter = document.body.style.filter === 'invert(1)' ? 'invert(0)' : 'invert(1)'; }
    function toggleFullScreen() { if (!document.fullscreenElement) document.documentElement.requestFullscreen(); else document.exitFullscreen(); }

    document.getElementById('date-display').innerText = dateFull;
</script>
</body>
</html>
