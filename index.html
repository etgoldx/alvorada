<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, viewport-fit=cover">
    <title>Alvorada - 1% todo dia</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@700&family=Quicksand:wght@400;500;600&family=Courier+Prime:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>

    <style>
        :root {
            --bg-color: #fdfaf6; --card-bg: #ffffff; --title-brown: #a68966;
            --add-red: #f28482; --check-green: #32cd32; --item-done-bg: #e8f5e9;
            --stats-green: #7ebc89; --bar-bg: rgba(0,0,0,0.05);
            --bar-1: #a8dadc; --bar-2: #ffcad4; --bar-3: #b9fbc0;
            --text-color: #5d5d5d; --date-color: #999;
            --input-border: #f0f0f0; --delete-red: #e74c3c;
        }

        [data-theme="dark"] {
            --bg-color: #1a1c22; --card-bg: #2d3039; --text-color: #e0e0e0;
            --input-border: #3d414d; --title-brown: #c5b299;
            --bar-bg: rgba(255,255,255,0.15); --item-done-bg: #1b3d2f;
        }

        body {
            font-family: 'Quicksand', sans-serif; background-color: var(--bg-color); color: var(--text-color);
            margin: 0; padding: env(safe-area-inset-top) 20px 100px 20px;
            display: flex; flex-direction: column; align-items: center; min-height: 100vh;
            transition: all 0.4s ease;
        }

        .container {
            width: 100%; max-width: 450px; background: var(--card-bg); padding: 30px;
            border-radius: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.05);
            margin-top: 20px; box-sizing: border-box;
        }

        /* T√≠tulo Esquerda, Contagem Direita */
        header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px; }
        h1 { font-family: 'Comfortaa', cursive; font-size: 1.5rem; margin: 0; color: var(--title-brown); }
        #current-date { font-size: 0.8rem; color: var(--date-color); text-transform: capitalize; }
        .streak-badge { font-weight: 700; color: #ff9f43; }

        /* Barra de Progresso */
        .progress-container { background: var(--bar-bg); border-radius: 20px; height: 14px; margin: 20px 0 5px; overflow: hidden; }
        .progress-bar { height: 100%; width: 0%; background: linear-gradient(90deg, var(--bar-1), var(--bar-2), var(--bar-3)); transition: 0.8s; }
        .stats-text { font-size: 0.9rem; text-align: right; margin-bottom: 25px; font-weight: 700; color: var(--stats-green); }

        /* Input e Bot√µes */
        .input-group { display: flex; gap: 10px; margin-bottom: 25px; }
        input[type="text"] { flex: 1; padding: 12px; border: 2px solid var(--input-border); background: var(--card-bg); color: var(--text-color); border-radius: 12px; outline: none; font-size: 16px; }
        .add-btn { background-color: var(--add-red); border: none; padding: 0 18px; border-radius: 12px; cursor: pointer; color: white; font-size: 1.5rem; }

        /* Lista de Tarefas */
        .todo-list { list-style: none; padding: 0; margin: 0; }
        .todo-item { 
            background: var(--card-bg); border: 1px solid var(--input-border); padding: 12px 15px; 
            border-radius: 15px; display: flex; align-items: center; margin-bottom: 10px; gap: 10px;
        }
        .todo-item.completed { background-color: var(--item-done-bg); }
        .todo-text { flex: 1; font-size: 0.95rem; }
        .delete-icon { cursor: pointer; opacity: 0.5; transition: 0.3s; }
        .delete-icon:hover { opacity: 1; color: var(--delete-red); }

        /* Grade de Dias */
        .history-grid { display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; margin-top: 30px; max-width: 450px; }
        .day-dot { width: 40px; height: 40px; border-radius: 50%; border: 2px solid var(--input-border); background: none; color: var(--date-color); cursor: pointer; font-weight: bold; }
        .day-dot.full { border-color: var(--stats-green); color: var(--stats-green); }

        /* Bot√£o Flutuante DarkLight (Imune ao Zoom) */
        .theme-toggle { position: fixed; bottom: 25px; right: 25px; width: 60px; height: 60px; border-radius: 50%; background: var(--title-brown); border: none; cursor: pointer; color: white; font-size: 1.5rem; box-shadow: 0 4px 15px rgba(0,0,0,0.2); z-index: 9999; }

        /* Estilo PDF Ticket */
        .ticket-receipt { font-family: 'Courier Prime', monospace; width: 80mm; padding: 10px; color: black; background: white; }

        /* Login Screen */
        #auth-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg-color); z-index: 10000; display: flex; align-items: center; justify-content: center; }
        .hidden { display: none !important; }
    </style>
</head>
<body ondblclick="toggleFullScreen()">

<div id="auth-screen">
    <div class="container" style="text-align: center;">
        <h1 style="margin-bottom: 30px;">Agente Alvorada</h1>
        <input type="text" id="auth-user" class="todo-text" style="width:100%; padding:15px; margin-bottom:10px; border:1px solid #ddd; border-radius:10px;" placeholder="Usu√°rio">
        <input type="password" id="auth-pass" style="width:100%; padding:15px; margin-bottom:20px; border:1px solid #ddd; border-radius:10px;" placeholder="Senha">
        <button onclick="handleAuth()" style="width:100%; padding:15px; background:var(--title-brown); color:white; border:none; border-radius:10px; font-weight:bold;">ENTRAR / CADASTRAR</button>
    </div>
</div>

<div class="container" id="main-app">
    <header>
        <div>
            <h1>Alvorada</h1> <div id="current-date"></div> </div>
        <div id="streak-display" class="streak-badge">üî• 0 dias</div> </header>

    <div class="progress-container">
        <div id="progress-bar" class="progress-bar"></div>
    </div>
    <div id="stats" class="stats-text">TOTAL: 0%</div> <div class="input-group">
        <input type="text" id="todo-input" placeholder="Nova miss√£o de hoje...">
        <button class="add-btn" onclick="addTodo()">+</button> </div>

    <ul id="todo-list" class="todo-list"></ul> <div id="motivation-quote" style="text-align:center; font-size:0.85rem; margin-top:25px; font-style:italic; opacity:0.8;"></div>

    <button style="margin-top:30px; width:100%; padding:12px; border-radius:15px; border:2px solid var(--title-brown); background:none; color:var(--title-brown); font-weight:bold; cursor:pointer;" onclick="generateTicketPDF()">
        üìÑ GERAR RELAT√ìRIO (TICKET)
    </button>
</div>

<div class="history-grid" id="history-grid"></div>

<button class="theme-toggle" onclick="toggleTheme()" id="theme-btn">üåô</button>

<script>
    // 1. Configura√ß√£o do Firebase (Ajustada para o seu projeto)
    const firebaseConfig = {
      apiKey: "AIzaSyAavmFHrcPo8OY60hnLo2dK4BsylPKvPAQ",
      authDomain: "alvorada-23e01.firebaseapp.com",
      projectId: "alvorada-23e01",
      storageBucket: "alvorada-23e01.firebasestorage.app",
      messagingSenderId: "173441904175",
      appId: "1:173441904175:web:7d3a7aba8b90afa05ea0da"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    const todayStr = new Date().toLocaleDateString('pt-BR');
    let agentData = { todos: [], percent: 0 };

    // 2. Frases Motivacionais (M√≠nimo 20)
    const quotes = [
        "A const√¢ncia √© a m√£e da aprova√ß√£o.", "1% melhor a cada novo dia.", "Vencer a si mesmo √© a maior das vit√≥rias.",
        "Mantenha o foco na miss√£o, o cargo vir√°.", "Seu esfor√ßo de hoje √© o seu distintivo de amanh√£.",
        "Estude enquanto eles dormem.", "A vaga √© sua por m√©rito e suor.", "F√© na miss√£o, Agente!",
        "A dor do estudo √© tempor√°ria, o cargo √© vital√≠cio.", "Nada vence a persist√™ncia inabal√°vel.",
        "Sua √∫nica competi√ß√£o √© com quem voc√™ foi ontem.", "Aprova√ß√£o exige sacrif√≠cio e estrat√©gia.",
        "Seja mais forte que sua melhor desculpa.", "Transforme suor em sucesso t√°tico.",
        "Miss√£o dada √© miss√£o cumprida.", "Paci√™ncia e resili√™ncia no caminho.",
        "O sucesso √© o ac√∫mulo de pequenos acertos di√°rios.", "Agente: sua rotina √© seu maior treinamento.",
        "O estudo √© a arma para mudar seu futuro.", "A farda custa caro, mas o pre√ßo vale a pena."
    ];

    // 3. Autentica√ß√£o
    function handleAuth() {
        const user = document.getElementById('auth-user').value.trim();
        const pass = document.getElementById('auth-pass').value;
        const email = `${user.toLowerCase()}@alvorada.com`;
        
        auth.signInWithEmailAndPassword(email, pass)
            .catch(() => auth.createUserWithEmailAndPassword(email, pass))
            .catch(err => alert("Erro: " + err.message));
    }

    auth.onAuthStateChanged(user => {
        if(user) {
            document.getElementById('auth-screen').classList.add('hidden');
            initApp();
        } else {
            document.getElementById('auth-screen').classList.remove('hidden');
        }
    });

    // 4. L√≥gica Principal
    async function initApp() {
        const uid = auth.currentUser.uid;
        const doc = await db.collection("usuarios").doc(uid).collection("dias").doc(todayStr.replace(/\//g, '-')).get();
        
        if(doc.exists) {
            agentData = doc.data();
        } else {
            // PACTO: Tarefas do dia X mantidas para o dia Y
            const last = await db.collection("usuarios").doc(uid).collection("dias").orderBy("__name__", "desc").limit(1).get();
            if(!last.empty) agentData.todos = last.docs[0].data().todos.map(t => ({...t, completed: false}));
        }
        
        document.getElementById('motivation-quote').innerText = `"${quotes[Math.floor(Math.random()*quotes.length)]}"`;
        updateUI();
        loadHistory();
    }

    function updateUI() {
        const list = document.getElementById('todo-list');
        list.innerHTML = '';
        let done = 0;

        agentData.todos.forEach((t, i) => {
            const li = document.createElement('li');
            li.className = `todo-item ${t.completed ? 'completed' : ''}`;
            li.innerHTML = `
                <input type="checkbox" ${t.completed ? 'checked' : ''} onchange="toggleTodo(${i})">
                <span class="todo-text">${t.text}</span>
                <span class="delete-icon" onclick="deleteTodo(${i})">üóëÔ∏è</span>
            `;
            list.appendChild(li);
            if(t.completed) done++;
        });

        const perc = agentData.todos.length > 0 ? Math.round((done / agentData.todos.length) * 100) : 0;
        agentData.percent = perc;
        
        document.getElementById('progress-bar').style.width = perc + '%';
        document.getElementById('stats').innerText = `TOTAL: ${perc}%`;
        
        if(perc === 100) confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
        saveCloud();
    }

    function saveCloud() {
        const uid = auth.currentUser.uid;
        db.collection("usuarios").doc(uid).collection("dias").doc(todayStr.replace(/\//g, '-')).set(agentData);
    }

    function addTodo() {
        const input = document.getElementById('todo-input');
        if(input.value) {
            agentData.todos.push({ text: input.value, completed: false });
            input.value = '';
            updateUI();
        }
    }

    function toggleTodo(i) { agentData.todos[i].completed = !agentData.todos[i].completed; updateUI(); }
    function deleteTodo(i) { agentData.todos.splice(i, 1); updateUI(); }

    // 5. Hist√≥rico e Resumo
    async function loadHistory() {
        const uid = auth.currentUser.uid;
        const snap = await db.collection("usuarios").doc(uid).collection("dias").limit(14).get();
        const grid = document.getElementById('history-grid');
        grid.innerHTML = '';
        
        let streak = 0;
        snap.forEach((doc, index) => {
            const data = doc.data();
            const dot = document.createElement('button');
            dot.className = `day-dot ${data.percent === 100 ? 'full' : ''}`;
            dot.innerText = index + 1;
            dot.onclick = () => alert(`Dia ${doc.id}\nStatus: ${data.percent}%\nMiss√µes: ${data.todos.length}`);
            grid.appendChild(dot);
            if(data.percent === 100) streak++;
        });
        document.getElementById('streak-display').innerText = `üî• ${streak} dias`;
    }

    // 6. Relat√≥rio Ticket de Mercado
    function generateTicketPDF() {
        const ticket = document.createElement('div');
        ticket.className = 'ticket-receipt';
        
        let itemsHTML = agentData.todos.map(t => `
            <div style="display:flex; justify-content:space-between; margin-bottom:5px; font-size:12px;">
                <span>${t.text.toUpperCase()}</span>
                <span>${t.completed ? 'OK' : '--'}</span>
            </div>
        `).join('');

        ticket.innerHTML = `
            <div style="text-align:center; border-bottom:1px dashed #000; padding-bottom:10px; margin-bottom:10px;">
                <h2 style="margin:0;">RELAT√ìRIO</h2>
                <small>ALVORADA T√ÅTICO</small><br>
                <small>${todayStr}</small>
            </div>
            <div style="border-bottom:1px dashed #000; padding-bottom:10px; margin-bottom:10px;">
                <div style="display:flex; justify-content:space-between; font-weight:bold; margin-bottom:5px;">
                    <span>TAREFA</span><span>STATUS</span>
                </div>
                ${itemsHTML}
            </div>
            <div style="text-align:right; font-weight:bold;">TOTAL: ${agentData.percent}%</div>
            <div style="text-align:center; margin-top:20px; font-size:10px;">*** OBRIGADO AGENTE ***</div>
        `;

        html2pdf().set({ margin: 10, filename: 'ticket-alvorada.pdf', jsPDF: { unit: 'mm', format: [80, 150] } }).from(ticket).save();
    }

    // 7. DarkMode e Fullscreen
    function toggleTheme() {
        const current = document.documentElement.getAttribute('data-theme');
        const next = current === 'dark' ? 'light' : 'dark';
        document.documentElement.setAttribute('data-theme', next);
        document.getElementById('theme-btn').innerText = next === 'dark' ? '‚òÄÔ∏è' : 'üåô';
    }

    function toggleFullScreen() {
        if (!document.fullscreenElement) document.documentElement.requestFullscreen();
        else if (document.exitFullscreen) document.exitFullscreen();
    }

    document.getElementById('current-date').innerText = new Date().toLocaleDateString('pt-BR', {weekday:'long', day:'numeric', month:'long'});
</script>
</body>
</html>
