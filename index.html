<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, viewport-fit=cover"> <meta name="apple-mobile-web-app-capable" content="yes"> <meta name="mobile-web-app-capable" content="yes"> <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"> <meta name="theme-color" content="#fdfaf6"> <title>Alvorada - 1% Todo Dia</title>
    
    <link rel="manifest" href="manifest.json"> <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@700&family=Quicksand:wght@400;500;600&display=swap" rel="stylesheet"> <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script> <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>

    <style>
        :root { /* Vari√°veis de cores - Modo Claro */
            --bg-color: #fdfaf6; --card-bg: #ffffff; --title-brown: #a68966;
            --add-red: #f28482; --check-green: #32cd32; --item-done-bg: #e8f5e9;
            --stats-green: #7ebc89; --bar-bg: rgba(0,0,0,0.05);
            --bar-1: #a8dadc; --bar-2: #ffcad4; --bar-3: #b9fbc0;
            --text-color: #5d5d5d; --date-color: #999;
            --input-border: #f0f0f0; --delete-red: #e74c3c;
        }

        [data-theme="dark"] { /* Vari√°veis de cores - Modo Escuro */
            --bg-color: #1a1c22; --card-bg: #2d3039; --text-color: #e0e0e0;
            --input-border: #3d414d; --title-brown: #c5b299;
            --bar-bg: rgba(255,255,255,0.15); --item-done-bg: #1b3d2f;
        }

        body { /* Estilo global e centraliza√ß√£o */
            font-family: 'Quicksand', sans-serif;
            background-color: var(--bg-color); color: var(--text-color);
            margin: 0; padding: env(safe-area-inset-top) 20px 80px 20px;
            display: flex; flex-direction: column; align-items: center;
            transition: all 0.4s ease; min-height: 100vh;
        }

        #auth-container { /* Tela de autentica√ß√£o fixa */
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg-color); z-index: 9999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .auth-hidden { opacity: 0; visibility: hidden; pointer-events: none; transition: 0.8s; }

        .container { /* Caixa principal do conte√∫do */
            width: 100%; max-width: 450px;
            background: var(--card-bg); padding: 30px; border-radius: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
            margin-top: 20px; position: relative; box-sizing: border-box;
        }

        header { margin-bottom: 35px; } /* Espa√ßamento do topo */
        h1 { font-family: 'Comfortaa', cursive; font-size: 1.5rem; margin: 0; color: var(--title-brown); } /* Estilo do t√≠tulo */
        #current-date { font-size: 0.85rem; color: var(--date-color); font-weight: 600; text-transform: capitalize; margin-top: 8px; display: block; } /* Data por extenso */
        
        .progress-container { background: var(--bar-bg); border-radius: 20px; height: 14px; margin-bottom: 10px; overflow: hidden; } /* Container da barra */
        .progress-bar { height: 100%; width: 0%; background: linear-gradient(90deg, var(--bar-1), var(--bar-2), var(--bar-3)); transition: width 0.8s ease; } /* Preenchimento barra */
        .stats-text { font-size: 0.9rem; text-align: right; margin-bottom: 25px; font-weight: 700; color: var(--stats-green); } /* Porcentagem do Total */

        .input-group { display: flex; gap: 10px; margin-bottom: 25px; } /* Grupo de entrada */
        input[type="text"], input[type="password"] { /* Estilo dos campos de texto */
            flex: 1; padding: 12px; border: 2px solid var(--input-border); 
            background: var(--card-bg); color: var(--text-color); 
            border-radius: 12px; outline: none; font-family: inherit; font-size: 16px !important;
        }

        .todo-item { /* Estilo dos itens da lista */
            background: var(--card-bg); border: 1px solid var(--input-border); 
            padding: 12px 15px; border-radius: 15px; display: flex; 
            align-items: center; margin-bottom: 12px; transition: transform 0.2s;
        }

        .delete-btn { background: none; border: none; cursor: pointer; opacity: 0.5; margin-left: auto; } /* Lixeira √† direita */

        #motivation-box { font-style: italic; font-size: 0.85rem; color: var(--date-color); text-align: center; margin-top: 20px; min-height: 40px; } /* Frases motivacionais */

        .theme-toggle { position: fixed; bottom: 20px; right: 20px; width: 50px; height: 50px; border-radius: 50%; background: var(--title-brown); border: none; cursor: pointer; color: white; z-index: 999; } /* Bot√£o tema */
        .pdf-btn { background: none; border: 1px solid var(--title-brown); color: var(--title-brown); padding: 8px 15px; border-radius: 10px; font-size: 0.7rem; cursor: pointer; margin-top: 10px; } /* Bot√£o PDF */
    </style>
</head>
<body ondblclick="toggleFullScreen()"> <div id="auth-container">
    <div class="container" style="text-align: center;">
        <h1 id="auth-title">Portaria Alvorada</h1>
        <input type="text" id="auth-login" placeholder="Nome de Usu√°rio" style="width: 100%; margin-top: 20px; margin-bottom: 10px; box-sizing: border-box;">
        <input type="password" id="auth-password" placeholder="Senha" style="width: 100%; margin-bottom: 20px; box-sizing: border-box;">
        <button onclick="handleAuth()" id="auth-btn" style="width:100%; padding:15px; background:var(--title-brown); color:white; border:none; border-radius:12px; font-weight:bold; cursor:pointer;">ACESSAR SISTEMA</button>
        <p id="auth-toggle-text" style="cursor:pointer; margin-top:15px; font-size:0.85rem; color: var(--title-brown); text-decoration: underline;" onclick="toggleAuthMode()">N√£o tem conta? Cadastre-se</p>
        <p id="auth-error" style="color:var(--delete-red); font-size:0.8rem; margin-top:15px; min-height: 1.2em;"></p>
    </div>
</div>

<div class="container" id="pdf-area">
    <header>
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <h1>Alvorada</h1>
            <div id="streak-display" style="font-weight: 700; color: #ff9f43;">üî• 0 dias</div>
        </div>
        <span id="current-date">Carregando data...</span> </header>

    <div class="progress-container"><div id="progress-bar" class="progress-bar"></div></div>
    <div id="stats" class="stats-text">TOTAL: 0%</div> <div class="input-group">
        <input type="text" id="todo-input" placeholder="Nova miss√£o de hoje...">
        <button onclick="addTodo()" style="background:var(--add-red); border:none; padding:0 18px; border-radius:12px; color:white; font-weight:bold; font-size:1.5rem; cursor:pointer;">+</button>
    </div>

    <ul id="todo-list" style="list-style: none; padding: 0; margin-bottom: 20px;"></ul>
    
    <div id="motivation-box"></div> </div>

<div style="display: flex; flex-direction: column; align-items: center; gap: 10px;">
    <button onclick="downloadPDF()" class="pdf-btn">Salvar em PDF</button> <button onclick="firebase.auth().signOut()" style="background:none; border:none; color:var(--date-color); font-size:0.7rem; cursor:pointer; text-decoration:underline;">Sair do Sistema</button>
</div>

<button class="theme-toggle" onclick="toggleTheme()" id="theme-btn">üåô</button>

<script>
    // Configura√ß√µes do Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyAavmFHrcPo8OY60hnLo2dK4BsylPKvPAQ",
      authDomain: "alvorada-23e01.firebaseapp.com",
      projectId: "alvorada-23e01",
      storageBucket: "alvorada-23e01.firebasestorage.app",
      messagingSenderId: "173441904175",
      appId: "1:173441904175:web:7d3a7aba8b90afa05ea0da"
    };

    firebase.initializeApp(firebaseConfig); // Inicializa app
    const db = firebase.firestore(); // Conecta Firestore
    const todayStr = new Date().toLocaleDateString('pt-BR'); // Data chave para o banco
    let dbLocal = { todos: [], percent: 0 }; // Mem√≥ria local
    let isLoginMode = true;

    // As 20 frases de motiva√ß√£o restauradas
    const motivationPhrases = [
        "1% melhor a cada dia.", "O sucesso √© a soma de pequenos esfor√ßos.", "Feito √© melhor que perfeito.",
        "N√£o pare at√© se orgulhar.", "Sua √∫nica competi√ß√£o √© quem voc√™ foi ontem.", "A disciplina √© a alma da liberdade.",
        "Foco no processo, o resultado √© consequ√™ncia.", "Grandes jornadas come√ßam com um passo.",
        "Mantenha a const√¢ncia.", "Ven√ßa a si mesmo.", "Resili√™ncia √© seu superpoder.",
        "Agente, sua miss√£o √© sua prioridade.", "Estude enquanto eles dormem.", "A aprova√ß√£o exige sacrif√≠cio.",
        "Cada tarefa conclu√≠da √© um passo rumo √† PC.", "Padr√£o Alvorada: Excel√™ncia.", "Sem desculpas.",
        "O cansa√ßo passa, o cargo fica.", "Seja impar√°vel.", "Miss√£o dada √© miss√£o cumprida."
    ];

    // Alterna Login/Cadastro
    function toggleAuthMode() {
        isLoginMode = !isLoginMode;
        document.getElementById('auth-title').innerText = isLoginMode ? "Portaria Alvorada" : "Recrutamento Alvorada";
        document.getElementById('auth-btn').innerText = isLoginMode ? "ACESSAR SISTEMA" : "CRIAR MINHA CONTA";
        document.getElementById('auth-toggle-text').innerText = isLoginMode ? "N√£o tem conta? Cadastre-se" : "J√° √© um Agente? Fa√ßa Login";
    }

    // Processa Autentica√ß√£o com Login Sanitizado
    function handleAuth() {
        const loginRaw = document.getElementById('auth-login').value.trim();
        const password = document.getElementById('auth-password').value;
        const btn = document.getElementById('auth-btn');
        const errorMsg = document.getElementById('auth-error');
        
        if(!loginRaw || !password) { errorMsg.innerText = "‚ö† Preencha login e senha."; return; }
        
        const safeLogin = loginRaw.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, ""); // Remove acentos
        const email = `${safeLogin}@alvorada.com`; // E-mail interno
        
        btn.innerText = "PROCESSANDO...";
        const action = isLoginMode 
            ? firebase.auth().signInWithEmailAndPassword(email, password)
            : firebase.auth().createUserWithEmailAndPassword(email, password);

        action.catch(err => {
            btn.innerText = isLoginMode ? "ACESSAR SISTEMA" : "CRIAR MINHA CONTA";
            errorMsg.innerText = "‚ùå Erro: " + err.message;
        });
    }

    // Monitor de estado do usu√°rio
    firebase.auth().onAuthStateChanged(user => {
        if(user) {
            document.getElementById('auth-container').classList.add('auth-hidden');
            loadData(); // Carrega dados ao logar
        } else {
            document.getElementById('auth-container').classList.remove('auth-hidden');
        }
    });

    // Carrega dados do Firestore
    async function loadData() {
        const user = firebase.auth().currentUser;
        if(!user) return;
        const doc = await db.collection("usuarios").doc(user.uid).collection("dias").doc(todayStr).get();
        if(doc.exists) {
            dbLocal = doc.data();
        }
        updateUI(); // Atualiza tela
        updateStreak(); // Atualiza contador de foguinhos
        showRandomPhrase(); // Mostra frase motivacional
    }

    // Atualiza toda a Interface
    function updateUI() {
        const list = document.getElementById('todo-list');
        list.innerHTML = ''; // Limpa lista
        let done = 0;
        
        dbLocal.todos.forEach(t => {
            const li = document.createElement('li');
            li.className = 'todo-item';
            li.innerHTML = `
                <input type="checkbox" ${t.completed ? 'checked' : ''} onchange="toggleTodo('${t.id}')" style="width:20px; height:20px;">
                <span style="margin-left:12px; flex:1; ${t.completed ? 'text-decoration:line-through; opacity:0.5' : ''}">${t.text}</span>
                <button class="delete-btn" onclick="deleteTodo('${t.id}')">üóëÔ∏è</button>
            `;
            list.appendChild(li);
            if(t.completed) done++;
        });

        const p = dbLocal.todos.length > 0 ? Math.round((done/dbLocal.todos.length)*100) : 0;
        if(p === 100 && dbLocal.percent < 100) confetti({ particleCount: 150, spread: 70 }); // Confete 100%
        
        dbLocal.percent = p;
        document.getElementById('progress-bar').style.width = p + '%';
        document.getElementById('stats').innerText = `TOTAL: ${p}%`; // Exibi√ß√£o Total % restaurada
        saveData(); // Grava no banco
    }

    // Salva no banco Firebase
    function saveData() {
        const user = firebase.auth().currentUser;
        if(user) db.collection("usuarios").doc(user.uid).collection("dias").doc(todayStr).set(dbLocal);
    }

    // Adiciona tarefa com ID √önico
    function addTodo() {
        const input = document.getElementById('todo-input');
        if(input.value) {
            dbLocal.todos.push({ id: Date.now().toString(), text: input.value, completed: false }); // ID √∫nico gerado
            input.value = '';
            updateUI();
        }
    }

    // Alterna status da tarefa
    function toggleTodo(id) {
        const t = dbLocal.todos.find(x => x.id === id);
        if(t) t.completed = !t.completed;
        updateUI();
    }

    // Deleta tarefa
    function deleteTodo(id) {
        dbLocal.todos = dbLocal.todos.filter(x => x.id !== id);
        updateUI();
    }

    // Atualiza Streak (Foguinho)
    async function updateStreak() {
        const user = firebase.auth().currentUser;
        const snapshot = await db.collection("usuarios").doc(user.uid).collection("dias").where("percent", "==", 100).get();
        document.getElementById('streak-display').innerText = `üî• ${snapshot.size} dias`;
    }

    // Mostra frase aleat√≥ria das 20
    function showRandomPhrase() {
        const rand = Math.floor(Math.random() * motivationPhrases.length);
        document.getElementById('motivation-box').innerText = motivationPhrases[rand];
    }

    // Alterna Tela Cheia (Double Click restaurado)
    function toggleFullScreen() {
        if (!document.fullscreenElement) document.documentElement.requestFullscreen();
        else if (document.exitFullscreen) document.exitFullscreen();
    }

    // Alterna Tema
    function toggleTheme() {
        const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
        document.documentElement.setAttribute('data-theme', theme);
        document.getElementById('theme-btn').innerText = theme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
    }

    // Gera PDF (Restaurado)
    function downloadPDF() {
        const element = document.getElementById('pdf-area');
        html2pdf().from(element).save(`Alvorada_${todayStr}.pdf`);
    }

    // Define data por extenso (Ex: Quinta-feira, 29 de janeiro) restaurado
    const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
    document.getElementById('current-date').innerText = new Date().toLocaleDateString('pt-BR', options);
</script>
</body>
</html>
